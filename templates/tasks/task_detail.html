{% extends "base.html" %}
{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">{{ task.name }}</h1>

    <div class="card mb-4">
      <div class="card-body">
        <p><strong>Status:</strong> {{ task.get_status_display }}</p>
        <p><strong>Scheduled At:</strong> {{ task.scheduled_at|date:"Y-m-d H:i" }}</p>
        <p><strong>Assigned To:</strong> {{ task.assigned_to|default:"â€”" }}</p>
        <p><strong>Description:</strong> {{ task.description|linebreaks }}</p>
      </div>
    </div>

    <h3>
      Garden Beds
      <a href="{{ add_bed_url }}" class="btn btn-sm btn-primary ms-2">+ Add</a>
    </h3>
    <table class="table table-sm table-bordered align-middle mb-4">
      <thead>
      <tr>
        <th>Name</th>
        <th class="text-center" style="width:150px;">Actions</th>
      </tr>
      </thead>
      <tbody>
      {% for bt in beds %}
        <tr>
          <td>{{ bt.bed.name }}</td>
          <td class="text-center">
            <a href="{% url 'tasks:gardenbedtask_edit' bt.pk %}" class="btn btn-sm btn-outline-warning">Edit</a>
            <a href="{% url 'tasks:gardenbedtask_delete' bt.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="2" class="text-center">No beds assigned.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <h3>
      Materials Used
      <a href="{{ add_material_url }}" class="btn btn-sm btn-primary ms-2">+ Add</a>
    </h3>
    <table class="table table-sm table-bordered align-middle mb-4">
      <thead>
      <tr>
        <th>Name</th>
        <th>Quantity</th>
        <th class="text-center" style="width:150px;">Actions</th>
      </tr>
      </thead>
      <tbody>
      {% for mu in materials %}
        <tr>
          <td>{{ mu.material.name }}</td>
          <td>{{ mu.quantity_used }} {{ mu.material.unit }}</td>
          <td class="text-center">
            <a href="{% url 'tasks:materialusage_edit' mu.pk %}" class="btn btn-sm btn-outline-warning">Edit</a>
            <a href="{% url 'tasks:materialusage_delete' mu.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="3" class="text-center">No materials assigned.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <h3>
      Tools Used
      <a href="{{ add_tool_url }}" class="btn btn-sm btn-primary ms-2">+ Add</a>
    </h3>
    <table class="table table-sm table-bordered align-middle mb-4">
      <thead>
      <tr>
        <th>Name</th>
        <th class="text-center" style="width:150px;">Actions</th>
      </tr>
      </thead>
      <tbody>
      {% for tt in tools %}
        <tr>
          <td>{{ tt.tool.name }}</td>
          <td class="text-center">
            <a href="{% url 'tasks:tasktool_edit' tt.pk %}" class="btn btn-sm btn-outline-warning">Edit</a>
            <a href="{% url 'tasks:tasktool_delete' tt.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="2" class="text-center">No tools assigned.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="mt-4">
      <a href="{% url 'tasks:task_edit' task.pk %}" class="btn btn-warning">Edit Task</a>
      <a href="{% url 'tasks:task_delete' task.pk %}" class="btn btn-danger">Delete Task</a>
      <a href="{% url 'tasks:task_list' %}" class="btn btn-secondary">Back to List</a>
    </div>
  </div>
{% endblock %}
